<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline' https://appleid.cdn-apple.com https://cdn.auth0.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https://*.github.io https://*.googleapis.com https://api.github.com https://graph.microsoft.com https://appleid.apple.com https://orcid.org https://integrator-1438440.okta.com; form-action 'self' https://appleid.apple.com https://accounts.google.com https://github.com https://login.microsoftonline.com https://orcid.org https://integrator-1438440.okta.com; frame-ancestors 'none';" />
    <title>CraftX.py • Elevate your Python AI</title>
    <style>
        :root {
            --accent: #2196F3;
            --bg: #f9f9fb;
            --dark: #222;
            --light: #fff;
            --radius: 6px;
            --spacing: 1rem;
            --font: 'Segoe UI', Roboto, sans-serif;
        }

        /* Base resets */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font);
            color: var(--dark);
            background: var(--bg);
            line-height: 1.5;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        /* Layout */
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: var(--spacing);
        }

        header,
        footer {
            text-align: center;
            padding: var(--spacing) 0;
        }

        /* Hero */
        .hero {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 4rem 0;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .hero p.subtitle {
            font-size: 1.25rem;
            color: #555;
            max-width: 600px;
            text-align: center;
        }

        .signin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.75rem;
            margin-top: 2rem;
            width: 100%;
            max-width: 600px;
        }

        .btn-oauth {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem;
            background: var(--light);
            border: 1px solid #ccc;
            border-radius: var(--radius);
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s, border-color 0.2s;
        }

        .btn-oauth:hover {
            background: var(--accent);
            color: var(--light);
            border-color: var(--accent);
        }

        .btn-oauth svg {
            width: 20px;
            height: 20px;
            margin-right: 0.5rem;
            fill: currentColor;
        }

        .btn-oauth.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* WebAuthn/Passkey Styles */
        .webauthn-section {
            margin-top: 2rem;
            text-align: center;
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 1.5rem 0;
            color: #666;
            font-size: 0.85rem;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #ddd;
        }

        .divider span {
            padding: 0 1rem;
        }

        .btn-passkey {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            gap: 0.5rem;
        }

        .btn-passkey:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-passkey:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .passkey-info {
            display: block;
            margin-top: 0.5rem;
            color: #666;
            font-size: 0.8rem;
        }

        /* Sections */
        section {
            margin-top: 3rem;
        }

        section h2 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        section p {
            margin-top: 0.5rem;
            color: #444;
        }

        /* Footer */
        footer p {
            font-size: 0.85rem;
            color: #777;
        }

        /* Authentication Modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .auth-modal-content {
            background: white;
            padding: 2rem;
            border-radius: var(--radius);
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .auth-modal-content h3 {
            margin-bottom: 1rem;
            color: var(--dark);
        }

        .auth-modal-content p {
            margin: 0.5rem 0;
            color: #666;
        }

        .auth-modal-content .btn {
            margin-top: 1rem;
            padding: 0.75rem 1.5rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.9rem;
        }

        .auth-modal-content .btn:hover {
            background: #1976D2;
        }
    </style>
</head>

<body>
    <header class="container">
        <h1>CraftX.py</h1>
        <p class="subtitle">Python-native intelligence, modular by design.</p>
    </header>

    <section class="hero container">
        <p class="subtitle">
            A next-generation AI framework that evolves with you. Sign in to download and start building intelligent,
            ethical, and extensible Python apps today.
        </p>
        <div class="signin-grid" id="oauth-buttons">
            <!-- Buttons will be enabled once JS detects your auth endpoint -->
            <button class="btn-oauth" data-provider="microsoft">
                <svg viewBox="0 0 24 24">
                    <path fill="#F25022" d="M1 1h10v10H1z" />
                    <path fill="#00A4EF" d="M13 1h10v10H13z" />
                    <path fill="#7FBA00" d="M1 13h10v10H1z" />
                    <path fill="#FFB900" d="M13 13h10v10H13z" />
                </svg>
                Microsoft
            </button>
            <button class="btn-oauth" data-provider="apple">
                <svg viewBox="0 0 24 24">
                    <path fill="#000000"
                        d="M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z" />
                </svg>
                Apple
            </button>
            <button class="btn-oauth" data-provider="google">
                <svg viewBox="0 0 24 24">
                    <path fill="#4285F4"
                        d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                    <path fill="#34A853"
                        d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                    <path fill="#FBBC05"
                        d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
                    <path fill="#EA4335"
                        d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                </svg>
                Google
            </button>
            <button class="btn-oauth" data-provider="okta">
                <svg viewBox="0 0 24 24">
                    <path fill="#007DC1"
                        d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 2.4c5.302 0 9.6 4.298 9.6 9.6s-4.298 9.6-9.6 9.6S2.4 17.302 2.4 12 6.698 2.4 12 2.4z" />
                    <circle fill="#007DC1" cx="12" cy="12" r="4.8" />
                    <circle fill="#FFFFFF" cx="12" cy="12" r="2.4" />
                </svg>
                Okta
            </button>
            <button class="btn-oauth" data-provider="orcid">
                <svg viewBox="0 0 24 24">
                    <path fill="#A6CE39" d="M12 0C5.372 0 0 5.372 0 12s5.372 12 12 12 12-5.372 12-12S18.628 0 12 0z" />
                    <circle fill="#FFFFFF" cx="7.369" cy="5.325" r="0.947" />
                    <rect fill="#FFFFFF" x="6.647" y="7.416" width="1.444" height="10.041" />
                    <path fill="#FFFFFF"
                        d="M10.209 7.416h3.9c3.712 0 5.344 2.653 5.344 5.025 0 2.578-2.016 5.016-5.325 5.016h-3.919V7.416zm1.444 1.303v7.444h2.297c2.359 0 4.053-1.303 4.053-3.722 0-2.297-1.694-3.722-4.053-3.722h-2.297z" />
                </svg>
                ORCID
            </button>
            <button class="btn-oauth" data-provider="github">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M12 .5C5.7.5.5 5.7.5 12c0 5.1 3.3 9.4 7.8 10.9.6.1.8-.2.8-.5v-1.8c-3.2.7-3.8-1.5-3.8-1.5-.5-1.3-1.3-1.6-1.3-1.6-1-.7.1-.7.1-.7 1.1.1 1.7 1.1 1.7 1.1 1 .1 1.7-.7 1.7-.7.9-1.7 2.4-1.2 3-.9.1-.7.4-1.2.8-1.5-2.5-.3-5.1-1.3-5.1-5.7 0-1.3.5-2.4 1.2-3.3 0-.3-.5-1.4.1-2.8 0 0 1-.3 3.3 1.2 1-.3 2-.5 3-.5s2 .2 3 .5c2.3-1.5 3.3-1.2 3.3-1.2.6 1.4.1 2.5.1 2.8.8.9 1.2 2 1.2 3.3 0 4.4-2.6 5.4-5.1 5.7.4.3.8 1 .8 2v2.9c0 .3.2.6.8.5C20.7 21.4 24 17.1 24 12c0-6.3-5.2-11.5-12-11.5z" />
                </svg>
                GitHub
            </button>
        </div>

        <!-- WebAuthn/Passkey Section -->
        <div class="webauthn-section">
            <div class="divider">
                <span>or use a passkey</span>
            </div>
            <button class="btn-passkey" id="passkey-btn">
                <svg viewBox="0 0 24 24" width="20" height="20">
                    <path fill="currentColor"
                        d="M6 10v2h3v-2a3 3 0 0 1 6 0v2h3v-2a6 6 0 0 0-12 0zm-2 2a2 2 0 0 1 2-2h1V8a5 5 0 0 1 10 0v2h1a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-8zm8 5a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
                </svg>
                Sign in with Passkey
            </button>
            <small class="passkey-info">Use your fingerprint, face, or security key</small>
        </div>
    </section>

    <section class="container" id="about">
        <h2>Why CraftX.py?</h2>
        <p>
            Born from a passion for ethical AI and modular design, CraftX.py empowers developers to build next-level
            Python applications. We keep the core lean, plugin-driven, and fully extensible—so your code can grow as
            your ideas do.
        </p>

        <h2>About ElevateCraft</h2>
        <p>
            ElevateCraft is a community and platform dedicated to sovereignty, reproducibility, and responsible
            innovation. Our mission is to uplift developers and organizations by providing transparent, open-source
            tooling that respects privacy and fosters collaboration.
        </p>

        <h2>AI Oversight & Safety</h2>
        <p>
            Every download is vetted through an embedded AI Safety Officer powered by a proprietary model. This on-board
            guardian scans your configuration and usage patterns to prevent malicious activity, ensuring CraftX.py
            remains a force for good.
        </p>
    </section>

    <footer class="container">
        <p>&copy; 2025 ElevateCraft • MIT License • <a href="/terms.html">Terms</a> • <a
                href="/privacy.html">Privacy</a></p>
    </footer>

    <script>
        // Check if we have serverless functions support
        const hasServerlessFunctions = window.location.hostname === 'craftx.elevatecraft.org' ||
            window.location.hostname.includes('netlify.app');

        // Check for authentication success
        checkAuthSuccess();

        // OAuth button functionality
        document.querySelectorAll('.btn-oauth').forEach(btn => {
            btn.addEventListener('click', () => {
                const provider = btn.dataset.provider;
                authenticateWithProvider(provider);
            });
        });

        // GitHub Pages OAuth Configuration
        const oauthConfig = {
            github: {
                clientId: 'Ov23liRUYFgTsZhTpYjs',
                authUrl: 'https://github.com/login/oauth/authorize',
                scope: 'user:email'
            },
            google: {
                clientId: '53060370473-27ho267cg9fvra06acb1459kekreckuu.apps.googleusercontent.com',
                authUrl: 'https://accounts.google.com/oauth2/auth',
                scope: 'openid email profile'
            },
            okta: {
                clientId: '0oau9ecw5cydP8f7y697',
                authUrl: 'https://integrator-1438440.okta.com/oauth2/v1/authorize',
                scope: 'openid email profile'
            },
            orcid: {
                clientId: 'APP-0QF3NY1SS7CIEZZQ',
                authUrl: 'https://orcid.org/oauth/authorize',
                scope: '/authenticate'
            },
            microsoft: {
                clientId: 'your-microsoft-client-id', // You'll need to get this from Azure
                authUrl: 'https://login.microsoftonline.com/common/oauth2/v2.0/authorize',
                scope: 'openid email profile'
            }
        };

        function authenticateWithProvider(provider) {
            // Special handling for Apple
            if (provider === 'apple') {
                window.location.href = 'apple-signin.html';
                return;
            }

            const config = oauthConfig[provider];
            if (!config) {
                alert(`${provider} authentication not configured yet`);
                return;
            }

            // Generate state for security
            const state = generateRandomState();
            localStorage.setItem('oauth_state', state);
            localStorage.setItem('oauth_provider', provider);

            // Build OAuth URL
            const redirectUri = window.location.origin + window.location.pathname;
            const params = new URLSearchParams({
                client_id: config.clientId,
                redirect_uri: redirectUri,
                scope: config.scope,
                response_type: 'code',
                state: state
            });

            // Special handling for different providers
            if (provider === 'google') {
                params.set('access_type', 'offline');
                params.set('prompt', 'consent');
            } else if (provider === 'microsoft') {
                params.set('response_mode', 'query');
            }

            // Redirect to OAuth provider
            window.location.href = `${config.authUrl}?${params.toString()}`;
        }

        function generateRandomState() {
            return Math.random().toString(36).substring(2, 15) +
                Math.random().toString(36).substring(2, 15);
        }

        // Handle OAuth callback
        function handleOAuthCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const state = urlParams.get('state');
            const error = urlParams.get('error');
            const auth = urlParams.get('auth');
            const status = urlParams.get('status');

            // Handle Apple Sign In callback
            if (auth === 'apple') {
                if (status === 'success') {
                    showAuthSuccess('apple', 'success');
                } else if (status === 'error') {
                    const message = urlParams.get('message') || 'Unknown error';
                    showAuthError(`Apple Sign In Error: ${message}`);
                }
                // Clean URL
                window.history.replaceState({}, document.title, window.location.pathname);
                return;
            }

            if (error) {
                showAuthError(`OAuth Error: ${error}`);
                return;
            }

            if (code && state) {
                const savedState = localStorage.getItem('oauth_state');
                const provider = localStorage.getItem('oauth_provider');

                if (state !== savedState) {
                    showAuthError('Security error: Invalid state parameter');
                    return;
                }

                // Show success message
                showAuthSuccess(provider, code);

                // Clean up
                localStorage.removeItem('oauth_state');
                localStorage.removeItem('oauth_provider');

                // Clean URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        function showAuthSuccess(provider, code) {
            const modal = document.createElement('div');
            modal.className = 'auth-modal';
            modal.innerHTML = `
                <div class="auth-modal-content">
                    <h3>🎉 Authentication Successful!</h3>
                    <p><strong>Provider:</strong> ${provider}</p>
                    <p><strong>Status:</strong> ✅ Authenticated</p>
                    <p>You can now download CraftX.py!</p>
                    <button onclick="this.parentElement.parentElement.remove()" class="btn">Continue</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showAuthError(message) {
            const modal = document.createElement('div');
            modal.className = 'auth-modal';
            modal.innerHTML = `
                <div class="auth-modal-content">
                    <h3>❌ Authentication Error</h3>
                    <p>${message}</p>
                    <button onclick="this.parentElement.parentElement.remove()" class="btn">Try Again</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Check for OAuth callback on page load
        window.addEventListener('load', handleOAuthCallback);

        // WebAuthn/Passkey functionality
        const passkeyBtn = document.getElementById('passkey-btn');
        if (passkeyBtn) {
            passkeyBtn.addEventListener('click', handlePasskeyAuth);
        }

        async function handlePasskeyAuth() {
            if (!window.PublicKeyCredential) {
                alert('WebAuthn is not supported in this browser');
                return;
            }

            try {
                passkeyBtn.disabled = true;
                passkeyBtn.textContent = 'Authenticating...';

                // Try to authenticate with existing credential first
                const credentialId = '49cdd33f2a906bffed155c040cabce072d77588c503dd31e25f66cc860a13055';

                const credential = await navigator.credentials.get({
                    publicKey: {
                        challenge: new Uint8Array(32),
                        rpId: window.location.hostname,
                        allowCredentials: [{
                            type: 'public-key',
                            id: base64urlToBuffer(credentialId)
                        }],
                        userVerification: 'preferred',
                        timeout: 60000
                    }
                });

                if (credential) {
                    // Send credential to server for verification
                    const response = await fetch('/webauthn/authenticate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            credentialId: credentialId,
                            assertion: {
                                authenticatorData: bufferToBase64url(credential.response.authenticatorData),
                                clientDataJSON: bufferToBase64url(credential.response.clientDataJSON),
                                signature: bufferToBase64url(credential.response.signature)
                            }
                        })
                    });

                    const result = await response.json();

                    if (result.success) {
                        // Store authentication info
                        sessionStorage.setItem('auth_token', result.token);
                        sessionStorage.setItem('auth_provider', 'webauthn');
                        sessionStorage.setItem('auth_user', result.user);

                        showAuthSuccess('webauthn', result.user);
                    } else {
                        throw new Error(result.error);
                    }
                }
            } catch (error) {
                console.error('WebAuthn authentication failed:', error);
                alert('Authentication failed. Please try again or use an OAuth provider.');
            } finally {
                passkeyBtn.disabled = false;
                passkeyBtn.innerHTML = `
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M6 10v2h3v-2a3 3 0 0 1 6 0v2h3v-2a6 6 0 0 0-12 0zm-2 2a2 2 0 0 1 2-2h1V8a5 5 0 0 1 10 0v2h1a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-8zm8 5a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                    </svg>
                    Sign in with Passkey
                `;
            }
        }

        // Helper functions for WebAuthn
        function base64urlToBuffer(base64url) {
            const padding = '='.repeat((4 - base64url.length % 4) % 4);
            const base64 = base64url.replace(/-/g, '+').replace(/_/g, '/') + padding;
            const rawData = window.atob(base64);
            const outputArray = new Uint8Array(rawData.length);
            for (let i = 0; i < rawData.length; ++i) {
                outputArray[i] = rawData.charCodeAt(i);
            }
            return outputArray.buffer;
        }

        function bufferToBase64url(buffer) {
            const bytes = new Uint8Array(buffer);
            let str = '';
            for (let i = 0; i < bytes.byteLength; i++) {
                str += String.fromCharCode(bytes[i]);
            }
            return window.btoa(str).replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
        }

        function checkAuthSuccess() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            const provider = urlParams.get('provider');
            const user = urlParams.get('user');

            if (token && provider && user) {
                // Store authentication info
                sessionStorage.setItem('auth_token', token);
                sessionStorage.setItem('auth_provider', provider);
                sessionStorage.setItem('auth_user', decodeURIComponent(user));

                // Show success message and enable download
                showAuthSuccess(provider, decodeURIComponent(user));

                // Clean up URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        function showAuthSuccess(provider, user) {
            const successDiv = document.createElement('div');
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 5px;
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
            `;
            successDiv.innerHTML = `
                <strong>✅ Authentication Successful!</strong><br>
                Signed in with ${provider === 'webauthn' ? 'Passkey' : provider} as ${user}
                <button onclick="this.parentElement.remove()" style="
                    background: none;
                    border: none;
                    color: white;
                    float: right;
                    cursor: pointer;
                    font-size: 1.2em;
                ">×</button>
            `;

            document.body.appendChild(successDiv);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (successDiv.parentElement) {
                    successDiv.remove();
                }
            }, 5000);

            // Enable download button
            const downloadBtn = document.querySelector('.btn-download');
            if (downloadBtn) {
                downloadBtn.classList.remove('disabled');
                downloadBtn.style.opacity = '1';
                downloadBtn.style.cursor = 'pointer';
            }
        }

        function showLocalSetupModal(provider) {
            const modal = document.createElement('div');
            modal.id = 'setupModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;

            modal.innerHTML = `
                <div style="
                    background: white;
                    padding: 2rem;
                    border-radius: 10px;
                    max-width: 600px;
                    max-height: 80vh;
                    overflow-y: auto;
                    text-align: left;
                ">
                    <h2 style="color: var(--accent); margin-bottom: 1rem;">🚀 Setup Required</h2>
                    <p style="margin-bottom: 1rem;">To use ${provider.toUpperCase()} authentication, you need to run CraftX locally:</p>
                    
                    <div style="background: #f5f5f5; padding: 1rem; border-radius: 5px; margin-bottom: 1rem;">
                        <h3>Quick Setup Steps:</h3>
                        <ol style="margin: 1rem 0; padding-left: 1.5rem;">
                            <li><strong>Clone the repository:</strong><br>
                                <code style="background: #e0e0e0; padding: 2px 4px; border-radius: 3px;">git clone https://github.com/davidanderson01/CraftX.py.git</code>
                            </li>
                            <li><strong>Navigate to the directory:</strong><br>
                                <code style="background: #e0e0e0; padding: 2px 4px; border-radius: 3px;">cd CraftX.py/craftx-stack</code>
                            </li>
                            <li><strong>Install dependencies:</strong><br>
                                <code style="background: #e0e0e0; padding: 2px 4px; border-radius: 3px;">pip install -r requirements.txt</code>
                            </li>
                            <li><strong>Setup OAuth:</strong><br>
                                <code style="background: #e0e0e0; padding: 2px 4px; border-radius: 3px;">python oauth_setup.py</code>
                            </li>
                            <li><strong>Start the server:</strong><br>
                                <code style="background: #e0e0e0; padding: 2px 4px; border-radius: 3px;">python craftx.py</code>
                            </li>
                            <li><strong>Visit:</strong> <code style="background: #e0e0e0; padding: 2px 4px; border-radius: 3px;">http://localhost:8000</code></li>
                        </ol>
                    </div>
                    
                    <div style="background: #e8f5e8; padding: 1rem; border-radius: 5px; margin-bottom: 1rem;">
                        <h4>📖 For detailed instructions:</h4>
                        <p>View the complete OAuth setup guide: 
                            <a href="https://github.com/davidanderson01/CraftX.py/blob/main/craftx-stack/OAUTH_SETUP.md" target="_blank" style="color: var(--accent);">
                                OAuth Setup Guide
                            </a>
                        </p>
                    </div>
                    
                    <div style="text-align: center;">
                        <button onclick="document.getElementById('setupModal').remove()" style="
                            background: var(--accent);
                            color: white;
                            padding: 1rem 2rem;
                            border: none;
                            border-radius: 5px;
                            cursor: pointer;
                        ">Got it!</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        // After login, server should redirect back with a valid token
        // Example: ?token=eyJ... in URL
        function enableDownload() {
            // Replace hero with download CTA once authenticated
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('token')) {
                const hero = document.querySelector('.hero');

                // Show legal documents modal first
                showLegalDocumentsModal();

                hero.innerHTML = `
          <div style="text-align: center; padding: 2rem;">
            <h2 style="color: var(--accent); margin-bottom: 1rem;">Welcome to CraftX.py!</h2>
            <p style="margin-bottom: 1rem;">Please review and accept the legal documents below to proceed.</p>
            <button id="acceptLegalDocs" class="btn-oauth" style="width:100%; margin-top:1rem; opacity: 0.5;" disabled>
              Review Legal Documents First
            </button>
          </div>
        `;

                // Update footer to show all legal documents for logged-in users
                updateFooterForLoggedInUser();
            }
        }

        function showLegalDocumentsModal() {
            const modal = document.createElement('div');
            modal.id = 'legalModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;

            modal.innerHTML = `
                <div style="
                    background: white;
                    padding: 2rem;
                    border-radius: 10px;
                    max-width: 600px;
                    max-height: 80vh;
                    overflow-y: auto;
                    text-align: center;
                ">
                    <h2 style="color: var(--accent); margin-bottom: 1rem;">📋 Legal Documents</h2>
                    <p style="margin-bottom: 2rem;">As a new user, please review these important documents:</p>
                    
                    <div style="display: grid; gap: 1rem; margin-bottom: 2rem;">
                        <a href="/eula.html" target="_blank" style="
                            background: var(--accent);
                            color: white;
                            padding: 1rem;
                            border-radius: 5px;
                            text-decoration: none;
                            display: block;
                        ">📜 End User License Agreement (EULA)</a>
                        
                        <a href="/nda.html" target="_blank" style="
                            background: var(--accent);
                            color: white;
                            padding: 1rem;
                            border-radius: 5px;
                            text-decoration: none;
                            display: block;
                        ">🔒 Non-Disclosure Agreement (NDA)</a>
                    </div>
                    
                    <div style="margin-bottom: 2rem;">
                        <label style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <input type="checkbox" id="acceptEULA" />
                            <span>I have read and accept the EULA</span>
                        </label>
                        <label style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-top: 0.5rem;">
                            <input type="checkbox" id="acceptNDA" />
                            <span>I have read and accept the NDA</span>
                        </label>
                    </div>
                    
                    <button id="proceedButton" style="
                        background: #ccc;
                        color: white;
                        padding: 1rem 2rem;
                        border: none;
                        border-radius: 5px;
                        cursor: not-allowed;
                        margin-right: 1rem;
                    " disabled>Proceed to Download</button>
                    
                    <button onclick="document.getElementById('legalModal').remove()" style="
                        background: #666;
                        color: white;
                        padding: 1rem 2rem;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                    ">Close</button>
                </div>
            `;

            document.body.appendChild(modal);

            // Handle checkbox logic
            const eulaCheckbox = document.getElementById('acceptEULA');
            const ndaCheckbox = document.getElementById('acceptNDA');
            const proceedButton = document.getElementById('proceedButton');

            function updateProceedButton() {
                if (eulaCheckbox.checked && ndaCheckbox.checked) {
                    proceedButton.disabled = false;
                    proceedButton.style.background = 'var(--accent)';
                    proceedButton.style.cursor = 'pointer';
                    proceedButton.textContent = 'Proceed to Download';
                } else {
                    proceedButton.disabled = true;
                    proceedButton.style.background = '#ccc';
                    proceedButton.style.cursor = 'not-allowed';
                    proceedButton.textContent = 'Accept Documents to Continue';
                }
            }

            eulaCheckbox.addEventListener('change', updateProceedButton);
            ndaCheckbox.addEventListener('change', updateProceedButton);

            proceedButton.addEventListener('click', function () {
                if (eulaCheckbox.checked && ndaCheckbox.checked) {
                    const urlParams = new URLSearchParams(window.location.search);
                    const token = urlParams.get('token');

                    // Enable download button
                    const downloadBtn = document.getElementById('acceptLegalDocs');
                    if (downloadBtn) {
                        downloadBtn.innerHTML = '🚀 Download CraftX.py';
                        downloadBtn.disabled = false;
                        downloadBtn.style.opacity = '1';
                        downloadBtn.onclick = () => {
                            window.location.href = `/download/craftxpy.zip?token=${token}`;
                        };
                    }

                    // Close modal
                    modal.remove();

                    // Store acceptance in localStorage
                    localStorage.setItem('craftx_legal_accepted', 'true');
                    localStorage.setItem('craftx_legal_date', new Date().toISOString());
                }
            });
        }

        function updateFooterForLoggedInUser() {
            const footerLinks = document.querySelector('.footer-links');
            if (footerLinks && !footerLinks.querySelector('a[href="/eula.html"]')) {
                const eulaLink = document.createElement('a');
                eulaLink.href = '/eula.html';
                eulaLink.textContent = 'EULA';

                const ndaLink = document.createElement('a');
                ndaLink.href = '/nda.html';
                ndaLink.textContent = 'NDA';

                footerLinks.appendChild(eulaLink);
                footerLinks.appendChild(ndaLink);
            }
        }

        // Check if user has already accepted legal documents
        function checkLegalAcceptance() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('token') && localStorage.getItem('craftx_legal_accepted') === 'true') {
                updateFooterForLoggedInUser();
            }
        }

        window.addEventListener('load', function () {
            enableDownload();
            checkLegalAcceptance();
        });
    </script>
</body>

</html>